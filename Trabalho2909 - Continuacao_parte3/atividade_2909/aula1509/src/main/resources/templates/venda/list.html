<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br"
      th:replace="~{layout :: layout(~{::head}, ~{::main})}">

<head th:replace="~{fragments/head :: head('Lista de Vendas')}"></head>

<main class="flex-grow-1">
    <div class="container my-4">

        <div class="card shadow-lg border-0">

            <div class="card-header bg-primary text-white text-center py-3">
                <h2 class="mb-0">
                    <i class="bi bi-basket2-fill me-2"></i>Vendas
                </h2>
            </div>

            <div class="card-body">

                <div class="d-flex justify-content-center flex-wrap gap-2 mb-4">
                    <a th:href="@{/venda/form}" class="btn btn-success">
                        <i class="bi bi-cart-plus me-2"></i>Nova Venda
                    </a>
                </div>


                <!-- FORMULÁRIO ÚNICO DE FILTRO -->
                <form class="d-flex justify-content-center mb-4 flex-wrap gap-2"
                      method="get" th:action="@{/venda/list}">

                    <!-- FILTRAR POR CLIENTE -->
                    <select name="clienteId" class="btn btn-primary">
                        <option value="">Todos os clientes</option>
                        <option th:each="c : ${clientes}"
                                th:value="${c.id}"
                                th:selected="${clienteFiltro == c.id}"
                                th:text="${c.nomeExibicao}"></option>
                    </select>

                    <!-- FILTRAR POR DATA -->
                    <input
                            type="date"
                            name="data"
                            class="form-control w-auto me-2"
                            th:value="${dataFiltro}"
                    >

                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search"></i> Filtrar
                    </button>

                    <a th:href="@{/venda/list}" class="btn btn-secondary ms-2">
                        <i class="bi bi-x-circle"></i> Limpar
                    </a>
                </form>


                <div class="table-responsive">
                    <table class="table table-hover align-middle text-center mb-0">
                        <thead class="table-primary">
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Data</th>
                            <th scope="col">Total (R$)</th>
                            <th scope="col">Ações</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="venda : ${vendas}">
                            <td th:text="${venda.id}"></td>
                            <td th:text="${#temporals.format(venda.data, 'dd/MM/yyyy HH:mm')}"></td>
                            <td>
                                R$ <span th:text="${#numbers.formatDecimal(venda.total, 2, 'POINT', 2, 'COMMA')}"></span>
                            </td>
                            <td>
                                <a th:href="@{/venda/detail/{id}(id=${venda.id})}"
                                   class="btn btn-primary btn-sm">
                                    <i class="bi bi-eye"></i> Ver Detalhes
                                </a>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(vendas)}">
                            <td colspan="4" class="text-muted fst-italic">
                                Nenhuma venda encontrada.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</main>
</html>
