<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/Trabalho2909 - Continuacao_parte3/atividade_2909/aula1509/src/main/java/pweb/aula2909/controller/VendaController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Trabalho2909 - Continuacao_parte3/atividade_2909/aula1509/src/main/java/pweb/aula2909/controller/VendaController.java" />
              <option name="originalContent" value="package pweb.aula2909.controller;&#10;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.stereotype.Controller;&#10;import org.springframework.ui.ModelMap;&#10;import org.springframework.web.bind.annotation.*;&#10;import org.springframework.web.servlet.ModelAndView;&#10;import pweb.aula2909.model.entity.Venda;&#10;import pweb.aula2909.model.repository.VendaRepository;&#10;import pweb.aula2909.model.repository.PessoaFisicaRepository;&#10;import pweb.aula2909.model.repository.PessoaJuridicaRepository;&#10;import java.time.LocalDate;&#10;import java.time.LocalDateTime;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;&#10;@Controller&#10;@RequestMapping(&quot;/venda&quot;)&#10;public class VendaController {&#10;&#10;    @Autowired&#10;    private VendaRepository repository;&#10;&#10;    @Autowired&#10;    private PessoaFisicaRepository pessoaFisicaRepo;&#10;&#10;    @Autowired&#10;    private PessoaJuridicaRepository pessoaJuridicaRepo;&#10;&#10;    private LocalDateTime[] intervaloDia(String inicioData, String fimData) {&#10;        LocalDate dtInicio;&#10;        LocalDate dtFim;&#10;&#10;        if (inicioData != null &amp;&amp; !inicioData.isEmpty()) {&#10;            dtInicio = LocalDate.parse(inicioData);&#10;        } else if (fimData != null &amp;&amp; !fimData.isEmpty()) {&#10;            dtInicio = LocalDate.parse(fimData);&#10;        } else {&#10;            dtInicio = LocalDate.of(1, 1, 1);&#10;        }&#10;&#10;        if (fimData != null &amp;&amp; !fimData.isEmpty()) {&#10;            dtFim = LocalDate.parse(fimData);&#10;        } else if (inicioData != null &amp;&amp; !inicioData.isEmpty()) {&#10;            dtFim = LocalDate.parse(inicioData);&#10;        } else {&#10;            dtFim = LocalDate.now();&#10;        }&#10;&#10;        return new LocalDateTime[]{&#10;                dtInicio.atTime(0,0,0),&#10;                dtFim.atTime(23, 59, 59)&#10;        };&#10;    }&#10;&#10;&#10;    private List&lt;Object&gt; carregarClientes() {&#10;        List&lt;Object&gt; clientes = new ArrayList&lt;&gt;();&#10;        clientes.addAll(pessoaFisicaRepo.pessoasFisicas());&#10;        clientes.addAll(pessoaJuridicaRepo.pessoasJuridicas());&#10;        return clientes;&#10;    }&#10;&#10;&#10;    @GetMapping(&quot;/list&quot;)&#10;    public ModelAndView listar(@RequestParam(required = false) Long clienteId, @RequestParam(required = false) String dataInicio, @RequestParam(required = false) String dataFim, ModelMap model) {&#10;&#10;        List&lt;Venda&gt; vendas;&#10;&#10;        model.addAttribute(&quot;clientes&quot;, carregarClientes());&#10;&#10;        boolean temCliente = clienteId != null;&#10;        boolean temData = ( (dataInicio != null &amp;&amp; !dataInicio.isEmpty()) || (dataFim != null &amp;&amp; !dataFim.isEmpty()) );&#10;&#10;        if (temCliente &amp;&amp; temData) {&#10;            LocalDateTime[] intervalo = intervaloDia(dataInicio, dataFim);&#10;            vendas = repository.listarPorClienteEData(clienteId, intervalo[0], intervalo[1]);&#10;            model.addAttribute(&quot;clienteFiltro&quot;, clienteId);&#10;            model.addAttribute(&quot;dataInicioFiltro&quot;, dataInicio);&#10;            model.addAttribute(&quot;dataFimFiltro&quot;, dataFim);&#10;&#10;        } else if (temCliente) {&#10;            vendas = repository.listarPorCliente(clienteId);&#10;            model.addAttribute(&quot;clienteFiltro&quot;, clienteId);&#10;&#10;        } else if (temData) {&#10;&#10;            LocalDateTime[] intervalo = intervaloDia(dataInicio, dataFim);&#10;            vendas = repository.listarPorData(intervalo[0], intervalo[1]);&#10;            model.addAttribute(&quot;dataInicioFiltro&quot;, dataInicio);&#10;            model.addAttribute(&quot;dataFimFiltro&quot;, dataFim);&#10;&#10;        } else {&#10;            vendas = repository.listar();&#10;        }&#10;&#10;        model.addAttribute(&quot;vendas&quot;, vendas);&#10;&#10;        return new ModelAndView(&quot;/venda/list&quot;, model);&#10;    }&#10;&#10;    @GetMapping(&quot;/detail/{id}&quot;)&#10;    public ModelAndView detalhes(@PathVariable(&quot;id&quot;) Long id, ModelMap model) {&#10;        Venda venda = repository.buscarPorId(id);&#10;&#10;        if (venda != null) {&#10;            model.addAttribute(&quot;venda&quot;, venda);&#10;        }&#10;&#10;        return new ModelAndView(&quot;/venda/detail&quot;, model);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package pweb.aula2909.controller;&#10;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.stereotype.Controller;&#10;import org.springframework.ui.ModelMap;&#10;import org.springframework.web.bind.annotation.*;&#10;import org.springframework.web.servlet.ModelAndView;&#10;import pweb.aula2909.model.entity.Venda;&#10;import pweb.aula2909.model.repository.VendaRepository;&#10;import pweb.aula2909.model.repository.PessoaFisicaRepository;&#10;import pweb.aula2909.model.repository.PessoaJuridicaRepository;&#10;import java.time.LocalDate;&#10;import java.time.LocalDateTime;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;&#10;@Controller&#10;@RequestMapping(&quot;/venda&quot;)&#10;public class VendaController {&#10;&#10;    @Autowired&#10;    private VendaRepository repository;&#10;&#10;    @Autowired&#10;    private PessoaFisicaRepository pessoaFisicaRepo;&#10;&#10;    @Autowired&#10;    private PessoaJuridicaRepository pessoaJuridicaRepo;&#10;&#10;    private LocalDateTime[] intervaloDia(String inicioData, String fimData) {&#10;        LocalDate dtInicio;&#10;        LocalDate dtFim;&#10;&#10;        if (inicioData != null &amp;&amp; !inicioData.isEmpty()) {&#10;            dtInicio = LocalDate.parse(inicioData);&#10;        } else if (fimData != null &amp;&amp; !fimData.isEmpty()) {&#10;            dtInicio = LocalDate.parse(fimData);&#10;        } else {&#10;            dtInicio = LocalDate.of(1, 1, 1);&#10;        }&#10;&#10;        if (fimData != null &amp;&amp; !fimData.isEmpty()) {&#10;            dtFim = LocalDate.parse(fimData);&#10;        } else if (inicioData != null &amp;&amp; !inicioData.isEmpty()) {&#10;            dtFim = LocalDate.parse(inicioData);&#10;        } else {&#10;            dtFim = LocalDate.now();&#10;        }&#10;&#10;        return new LocalDateTime[]{&#10;                dtInicio.atTime(0,0,0),&#10;                dtFim.atTime(23, 59, 59)&#10;        };&#10;    }&#10;&#10;&#10;    private List&lt;Object&gt; carregarClientes() {&#10;        List&lt;Object&gt; clientes = new ArrayList&lt;&gt;();&#10;        clientes.addAll(pessoaFisicaRepo.pessoasFisicas());&#10;        clientes.addAll(pessoaJuridicaRepo.pessoasJuridicas());&#10;        return clientes;&#10;    }&#10;&#10;&#10;    @GetMapping(&quot;/list&quot;)&#10;    public ModelAndView listar(@RequestParam(required = false) Long clienteId, @RequestParam(required = false) String dataInicio, @RequestParam(required = false) String dataFim, ModelMap model) {&#10;&#10;        List&lt;Venda&gt; vendas;&#10;&#10;        model.addAttribute(&quot;clientes&quot;, carregarClientes());&#10;&#10;        boolean temCliente = clienteId != null;&#10;        boolean temData = ( (dataInicio != null &amp;&amp; !dataInicio.isEmpty()) || (dataFim != null &amp;&amp; !dataFim.isEmpty()) );&#10;&#10;        if (temCliente &amp;&amp; temData) {&#10;            LocalDateTime[] intervalo = intervaloDia(dataInicio, dataFim);&#10;            vendas = repository.listarPorClienteEData(clienteId, intervalo[0], intervalo[1]);&#10;            model.addAttribute(&quot;clienteFiltro&quot;, clienteId);&#10;            model.addAttribute(&quot;dataInicioFiltro&quot;, dataInicio);&#10;            model.addAttribute(&quot;dataFimFiltro&quot;, dataFim);&#10;&#10;        } else if (temCliente) {&#10;            vendas = repository.listarPorCliente(clienteId);&#10;            model.addAttribute(&quot;clienteFiltro&quot;, clienteId);&#10;&#10;        } else if (temData) {&#10;&#10;            LocalDateTime[] intervalo = intervaloDia(dataInicio, dataFim);&#10;            vendas = repository.listarPorData(intervalo[0], intervalo[1]);&#10;            model.addAttribute(&quot;dataInicioFiltro&quot;, dataInicio);&#10;            model.addAttribute(&quot;dataFimFiltro&quot;, dataFim);&#10;&#10;        } else {&#10;            vendas = repository.listar();&#10;        }&#10;&#10;        model.addAttribute(&quot;vendas&quot;, vendas);&#10;&#10;        return new ModelAndView(&quot;/venda/list&quot;, model);&#10;    }&#10;&#10;    @GetMapping(&quot;/detail/{id}&quot;)&#10;    public ModelAndView detalhes(@PathVariable(&quot;id&quot;) Long id, ModelMap model) {&#10;        Venda venda = repository.buscarPorId(id);&#10;&#10;        if (venda != null) {&#10;            model.addAttribute(&quot;venda&quot;, venda);&#10;        }&#10;&#10;        return new ModelAndView(&quot;/venda/detail&quot;, model);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>